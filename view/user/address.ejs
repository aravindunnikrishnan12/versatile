<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="/stylesheet/user/address.css">
<link rel="stylesheet" href="https://allyoucan.cloud/cdn/icofont/1.0.1/icofont.css" integrity="sha384-jbCTJB16Q17718YM9U22iJkhuGbS0Gd2LjaWb4YJEZToOPmnKDjySVa323U+W7Fv" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/197a2eac2f.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script>
      $(document).ready(function () {
           $('#sidebar-toggle').click(function () {
             $('.sidebar').toggleClass('show'); // Toggle .show class on sidebar
             $('#overlay').toggleClass('show-overlay'); // Toggle overlay
             $('#content').toggleClass('show-sidebar'); // Adjust content area
           });
     
           $(document).click(function (event) {
             // Check if the clicked element is not within the sidebar or sidebar toggle button
             if (!$(event.target).closest('.sidebar').length && !$(event.target).is('#sidebar-toggle')) {
               // Close the sidebar if it's currently open
               if ($('.sidebar').hasClass('show')) {
                 $('.sidebar').removeClass('show');
                 $('#overlay').removeClass('show-overlay');
                 $('#content').removeClass('show-sidebar');
               }
             }
           });
         });
         </script>
         <style>
          .search-form button {
        background-color: transparent;
        border: none;
        padding: 0;
        cursor: pointer;
    }

    /* Style for the search icon inside the button */
    .search-form button i {
        color: #000; /* Change this color to the desired color for the icon */
        font-size: 18px; /* Adjust the font size of the icon */
    }
         </style>
</head>
<body>


    <!--::header part start::-->
    <header class="main_menu home_menu">
      <div class="container">
          <div class="row align-items-center">
              <div class="col-lg-12">
                  <nav class="navbar navbar-expand-lg navbar-light">
                    
                      <i class="fa-solid fa-book fa-2x"></i> <!-- This will make the icon 3 times larger -->
               &nbsp;&nbsp;
                      <a class="navbar-brand" href=""> <h1>Versatile</h1></a>
                      <button class="navbar-toggler" type="button" data-toggle="collapse"
                          data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                          aria-expanded="false" aria-label="Toggle navigation">
                          <span class="menu_icon"><i class="fas fa-bars"></i></span>
                      </button>

                      <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                          <ul class="navbar-nav">
                              <li class="nav-item">
                                  <a class="nav-link" href="/home">Home</a>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="" id="navbarDropdown_1"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      Shop
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                      <a class="dropdown-item" href="/books">Book</a>
                                      
                                      
                                  </div>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      pages
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                      <a class="dropdown-item" href="/cartdisplay">Cart</a>
                                      <a class="dropdown-item" href="/wishlist">Wishlist</a>
                                      <!-- <a class="dropdown-item" href="">product checkout</a>
                                      <a class="dropdown-item" href="">shopping cart</a>
                                      <a class="dropdown-item" href="">confirmation</a>
                                      <a class="dropdown-item" href="">elements</a> -->
                                  </div>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="" id="navbarDropdown_2"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      Account
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                      <a class="dropdown-item" href="/logout">Log out</a>
                                     
                                  </div>
                              </li>
                              
                              <li class="nav-item">
                                  <a class="nav-link" href="/profile">Profile</a>
                              </li>
                          </ul>
                      </div>
                     

<form action="/search" method="GET" class="search-form">
  <a href="#" class="search-icon"></a>
  <input type="text" name="q" placeholder="Search..." class="search-input">
  <button type="submit"><i class="fas fa-search"></i></button>
</a>
</form>

                      </div>
                      
                  </nav>
              </div>
          </div>
      </div>
     
  </header>
  <!-- Header part end-->

  <div class="sidebar-button">
    <button id="sidebar-toggle" class="sidebar-toggle-btn custom-btn"><i class="fas fa-bars"></i></button>
  </div>
  <div class="sidebar">
    
    <div id="accordion">
        <ul>
            <li><a href="/profile" data-tag="dashboard">User profile</a></li>
            <li><a href="/address" data-tag="dashboard"></i>Address</a></li>
            <li><a href="/password" data-tag="category">Change password</a></li>
            <li><a href="/getorders" data-tag="product">Your Order</a></li>
            <li><a href="/coupons" data-tag="order">Coupon</a></li>
            <li><a href="#" data-tag="order">offers</a></li>
            
        </ul>
    </div>
  </div>
  

  
  
<div class="containers">
    <div class="row">
       
        <div class="col-md-9">
            <div class="osahan-account-page-right shadow-sm  p-4">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade  active show" id="addresses" role="tabpanel" aria-labelledby="addresses-tab">
                      <button type="button" class="btn btn-dark mt-2 ml-4 font-weight-bold" data-toggle="modal" data-target="#addAddressModal" style="background-color: #6b3e4b; border-radius: 20px;">Add Address</button>
                        <h4 class="font-weight-bold mt-0 mb-4 Manage">Manage Addresses</h4>
                        <div class="row">
                          <% addresses.forEach((address,index) => { %>
                              <div class="col-md-6">
                                  <div class="bg-white card addresses-item mb-4 shadow-sm" style=" border-radius: 20px;">
                                      <div class="gold-members p-4">
                                          <div class="media">
                                              <div class="mr-3"><i class="icofont-briefcase icofont-3x"></i></div>
                                              <div class="media-body">
                                                  <h6 class="mb-1"><%= address.type %></h6>
                                                  <p><%= address.address1 %>, <%= address.street %>, <%= address.country %>, <%= address.pincode %>,<%= address.phone %>,<%= address.additionalInfo %></p>
                                                  <p class="mb-0 text-black font-weight-bold">
                                                    <div class="button-group">
                                                      <!-- Edit button -->
                                                      <button class="btn btn-primary mr-3" data-toggle="modal" data-target="#edit-address-modal" onclick="editAddress('<%= JSON.stringify(address) %>')" style="background-color: #6b3e4b; border-radius: 20px;">
                                                          <i class="icofont-ui-edit" ></i> Edit
                                                      </button>
                                                    
                                                      <!-- Delete button -->
                                                      <form id="deleteForm<%= index %>" method="POST" action="/delete/<%= address._id %>" class="delete-form">
                                                          <button type="button" onclick="openModal('<%= index %>')" class="btn btn-danger" style="background-color: #6b3e4b; border-radius: 20px;">Delete</button>
                                                      </form>
                                                  </div>
                                                  </p>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          <% }); %>
                      </div>
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="confirmationModal" class="modal">
  <div class="modal-content" id="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <p>Are you sure you want to delete this product?</p>
    <button id="confirmDeleteButton" class="confirm-btn">Confirm</button>
  </div>
</div>



<!-- Modal 1: Add Address -->
<div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Form for adding address -->
        <form id="addAddressForm">
          <div class="form-group">
            <label for="address1">Address 1</label>
            <input type="text" class="form-control" name="address1" id="address1" required>
          </div>
          <div class="form-group">
            <label for="street">Street</label>
            <input type="text" class="form-control" name="street" id="street" required>
          </div>
          <div class="form-group">
            <label for="country">Country</label>
            <input type="text" class="form-control" name="country" id="country" required>
          </div>
          <div class="form-group">
            <label for="pincode">Pincode</label>
            <input type="text" class="form-control" name="pincode" id="pincode" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" class="form-control" name="phone" id="phone" required>
          </div>
          <div class="form-group">
            <label for="additionalInfo">Additional Information</label>
            <textarea class="form-control" name="additionalInfo" id="additionalInfo"></textarea>
          </div>
          <button type="submit" id="saveAddressBtn" class="btn btn-primary" style="background-color: #6b3e4b; border-radius: 20px;">Save Address</button>
        </form>
      </div>
    </div>
  </div>
</div>



<!-- Modal edit address -->
<div class="modal fade" id="edit-address-modal" tabindex="-1" role="dialog" aria-labelledby="editAddressModalLabel" aria-hidden="true">
  
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <!-- Add form fields for editing the address here -->
              <form id="editAddressForm">
                <div class="form-group">
                  <label for="edit-address1">Address 1</label>
                  <input type="text" class="form-control" name="address1" id="edit-address1" required>
                </div>
                <div class="form-group">
                  <label for="edit-street">Street</label>
                  <input type="text" class="form-control" name="street" id="edit-street" required>
                </div>
                <div class="form-group">
                  <label for="edit-country">Country</label>
                  <input type="text" class="form-control" name="country" id="edit-country" required>
                </div>
                <div class="form-group">
                  <label for="edit-pincode">Pincode</label>
                  <input type="text" class="form-control" name="pincode" id="edit-pincode" required>
                </div>
                <div class="form-group">
                  <label for="edit-phone">Phone Number</label>
                  <input type="tel" class="form-control" name="phone" id="edit-phone" required>
                </div>
                <div class="form-group">
                  <label for="edit-additionalInfo">Additional Information</label>
                  <textarea class="form-control" name="additionalInfo" id="edit-additionalInfo"></textarea>
                </div>

                <button type="button" id="editSaveChangesBtn" class="btn btn-primary mt-3" style="background-color: #6b3e4b; border-radius: 20px;">Save Changes</button>
              </form>
          </div>
      </div>
  </div>
</div>



<!-- modal delete -->
<script>
  function openModal(index) {
    document.getElementById('confirmationModal').style.display = 'block';
    // Pass the index to the confirmDelete function
    document.getElementById('confirmDeleteButton').onclick = function () {
      confirmDelete(index);
    };
  }

  function closeModal() {
    document.getElementById('confirmationModal').style.display = 'none';
  }

  function confirmDelete(index) {
    // Get the form dynamically using the index
    document.getElementById('deleteForm' + index).submit();
  }
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {
  const saveAddressBtn = document.getElementById('saveAddressBtn');

  saveAddressBtn.addEventListener('click', function (event) {
    event.preventDefault();

    const address1 = document.getElementById('address1').value;
    const street = document.getElementById('street').value;
    const country = document.getElementById('country').value;
    const pincode = document.getElementById('pincode').value;
    const phone = document.getElementById('phone').value;
    const additionalInfo = document.getElementById('additionalInfo').value;

    // Validation checks
    if (!phone || !/^\d{10}$/.test(phone)) {
      alert('Invalid Phone number');
      return;
    }

    if (!address1 || address1.trim().length === 0) {
      alert('Address field must be filled');
      return;
    }

    if (!street || street.trim().length === 0) {
      alert('Street field must be filled');
      return;
    }

    if (!country || country.trim().length === 0) {
      alert('Country field must be filled');
      return;
    }

    if (!pincode || !/^\d{6}$/.test(pincode)) {
      alert('Invalid Pincode');
      return;
    }

    if (!additionalInfo || additionalInfo.trim().length === 0) {
      alert('Additional information field must be filled');
      return;
    }

    const formData = {
      address1,
      street,
      country,
      pincode,
      phone,
      additionalInfo,
    };

    fetch('/Address', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData),
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        // Handle successful response
        if (data.success=true) {
        // Address updated successfully
        console.log('Address updated successfully');
        // Close the modal
        // document.querySelector('[data-dismiss="modal"]').click();
        window.location.href = '/address';
        // Show notification (assuming you have a showNotification function)
        showNotification('Address Addedd successfully');
      }
        // Optionally, you can redirect the user or perform other actions
      })
      .catch(error => {
        // Handle error
        console.error('There was a problem with your fetch operation:', error);
        // Optionally, you can display an error message to the user
      });
  });
});


</script>



<script>function editAddress(addressData) {
  const address = JSON.parse(addressData);

  document.getElementById('edit-address1').value = address.address1;
  document.getElementById('edit-street').value = address.street;
  document.getElementById('edit-country').value = address.country;
  document.getElementById('edit-pincode').value = address.pincode;
  document.getElementById('edit-phone').value = address.phone;
  document.getElementById('edit-additionalInfo').value = address.additionalInfo;

  const addressId = address._id;

  document.getElementById('editSaveChangesBtn').addEventListener('click', async function (event) {
    event.preventDefault();

    const phone = document.getElementById('edit-phone').value;
    const address1 = document.getElementById('edit-address1').value;
    const street = document.getElementById('edit-street').value;
    const country = document.getElementById('edit-country').value;
    const pincode = document.getElementById('edit-pincode').value;
    const additionalInfo = document.getElementById('edit-additionalInfo').value;

    // Validation checks
    if (!phone || !/^\d{10}$/.test(phone)) {
      alert('Invalid Phone number');
      return;
    }

    if (!address1 || address1.trim().length === 0) {
      alert('Address field must be filled');
      return;
    }

    if (!street || street.trim().length === 0) {
      alert('Street field must be filled');
      return;
    }

    if (!country || country.trim().length === 0) {
      alert('Country field must be filled');
      return;
    }

    if (!pincode || !/^\d{6}$/.test(pincode)) {
      alert('Invalid Pincode');
      return;
    }

    if (!additionalInfo || additionalInfo.trim().length === 0) {
      alert('Additional information field must be filled');
      return;
    }

    const updatedAddress = {
      address1: address1,
      street: street,
      country: country,
      pincode: pincode,
      phone: phone,
      additionalInfo: additionalInfo
    };

    try {
      const response = await fetch(`/edit/${addressId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          updatedAddress: updatedAddress,
        }),
      });

      if (response.ok) {
        // Address updated successfully
        console.log('Address updated successfully');
        // Close the modal
        // document.querySelector('[data-dismiss="modal"]').click();
        window.location.href = '/address';
        // Show notification (assuming you have a showNotification function)
        showNotification('Address updated successfully');
      } else {
        // Handle error response
        console.error('Error updating address:', response.statusText);
      }
    } catch (error) {
      // Handle fetch error
      console.error('Fetch error:', error);
    }
  });
}

</script>
<!-- modal 2 edit adress  -->

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8sh+Wy5x25EJwo0pm6d4Zvu25/TfMIqE2t9nq" crossorigin="anonymous"></script>
</body>
</html>